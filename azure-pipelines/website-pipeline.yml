trigger: none

pool:
  name: Lab
  demands:
    - Agent.OS -equals Linux

resources:
  repositories:
    - repository: template
      name: DevOps/Template
      type: git
  pipelines:
    - pipeline: package
      source: ngxtw-package
      trigger: true

variables:
  - ${{ if eq(variables['Build.SourceBranchName'], 'master') }}:
    - group: ngxtw-master
  - ${{ elseif eq(variables['Build.SourceBranchName'], 'next') }}:
    - group: ngxtw-next
  - ${{ elseif eq(variables['Build.SourceBranchName'], 'release') }}:
    - group: ngxtw-release
  - ${{ else }}:
    - group: ngxtw-dev

stages:
  - stage: CI
    jobs:
      - template: ngxtw/job.build-website.yml@template

  - stage: CD
    dependsOn: CI
    pool:
      name: Lab
      demands:
        - AZP_TARGET -equals website
    jobs:
      - template: ngxtw/job.release-website.yml@template
